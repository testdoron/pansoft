<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>IHMS2010</title>
    <link href="lib/extjs/resources/css/ext-all.css" rel="stylesheet" type="text/css" />
    <link href="lib/extjs/pan/panihms.css" rel="stylesheet" type="text/css" />
    <link href="lib/jquery.jqplot.0.9.7/dist/jquery.jqplot.min.css" rel="stylesheet" type="text/css" />
    <link href="css/modules.css" rel="stylesheet" type="text/css" />
    
    <!--[if IE]><script language="javascript" type="text/javascript" src="lib/jquery.jqplot.0.9.7/dist/excanvas.min.js"></script><![endif]-->
    <script src="lib/jquery.v1.4.1/jquery-1.4.1.js" type="text/javascript"></script>
    <script src="lib/jquery.jqplot.0.9.7/dist/jquery.jqplot.min.js" type="text/javascript"></script>
    <script src="lib/jquery.jqplot.0.9.7/dist/plugins/jqplot.categoryAxisRenderer.min.js" type="text/javascript"></script>
    <script src="lib/jquery.jqplot.0.9.7/dist/plugins/jqplot.barRenderer.min.js" type="text/javascript"></script>
    <script src="lib/extjs/adapter/ext/ext-base-debug.js" type="text/javascript"></script>
    <script src="lib/extjs/ext-all-debug.js" type="text/javascript"></script>
    <script src="lib/extjs/pan/panihms.js" type="text/javascript"></script>
    <script src="lib/am/amcolumn/swfobject.js" type="text/javascript"></script>
</head>

<body>
    <!------------------------------------>
    <!--       数据定义：GeanJs         -->
    <!------------------------------------>
    <script type="text/javascript">
        var GeanJs = {
            version: '2.0.1',
            email: 'nsimple.cn@gmail.com'
        }
    </script>

    <!-- GeanJs.GetBrowserHeight, GeanJs.GetBrowserWidth -->
    <script type="text/javascript">
        //获得浏览器可视界面的高度
        GeanJs.GetBrowserHeight = function() {
            if ($.browser.msie) {
                return document.compatMode == "CSS1Compat" ? document.documentElement.clientHeight : document.body.clientHeight;
            }
            else {
                return self.innerHeight;
            }
        }

        //获得浏览器可视界面的宽度
        GeanJs.GetBrowserWidth = function() {
            if ($.browser.msie) {
                return document.compatMode == "CSS1Compat" ? document.documentElement.clientWidth : document.body.clientWidth;
            }
            else {
                return self.innerWidth;
            }
        }
    </script>

    <!------------------------------------>
    <!--       数据定义：IHMSData       -->
    <!------------------------------------>
    <script type="text/javascript">
        var IHMSData = {
            version: '2010.6.0',
            email: 'lukan.pan@gmail.com'
        }
    </script>
    
    <!-- IHMSData.UITxt -->
    <script type="text/javascript">
        IHMSData.UITxt = {
            "StartMenuWorkerTxt": "登录用户",
            "StartMenuSettingTxt": "系统选项",
            "StartMenuLogoutTxt": "退出系统",
            "companyGroupTreeRoot": "组织机构",
            "Modules": 
            {
                "CustomManagementPanel": { "Text": "客户管理" },
                "OperationManagementPanel": { "Text": "业务管理" },
                "DeviceManagementPanel": { "Text": "设备管理" },
                "StatisticsManagementPanel": { "Text": "统计分析" },//StatisticsManagement
                "BookingManagementPanel": { "Text": "预约管理" },
                "SystemManagementPanel": { "Text": "系统管理" }
            }
        }
    </script>
    
    <!-- IHMSData.ConfigJson -->
    <script type="text/javascript">
        IHMSData.ConfigJson = {
            "SoftwareName": "力合智能大厅管理系统2010",
            "SoftwareVersion": "Base1",
            "WorkerName": "马英豪"
        }
    
    </script>
    
    <!-- IHMSData.CompanyGroup -->
    <script type="text/javascript">
        IHMSData.CompanyGroup =
        {
            "id": "0000 - root - 0000",
            "name": "平安银行北京分行",
            "items": [
                        { "id": "111", "name": "平安银行北京分行将台路分行" },
                        { "id": "222", "name": "平安银行北京分行亚运村分行" },
                        { "id": "333", "name": "平安银行北京分行平安大街分行" },
                        { "id": "444", "name": "平安银行北京分行昌平分行",
                            "items": 
                            [
                                { "id": "444 - 111", "name": "平安银行北京分行昌平南关大街分行" },
                                { "id": "444 - 222", "name": "平安银行北京分行昌平西关大街分行" },
                                { "id": "444 - 333", "name": "平安银行北京分行昌平北关大街分行" },
                                { "id": "444 - 444", "name": "平安银行北京分行昌平东关大街分行" }
                            ]
                        },
                        { "id": "555", "name": "平安银行北京分行顺义分行",
                            "items": 
                            [
                                { "id": "555 - 111", "name": "平安银行北京分行顺义府前西街分行" },
                                { "id": "555 - 222", "name": "平安银行北京分行顺义府前东街分行",
                                    "items": 
                                    [
                                        { "id": "555 - 222 - 111", "name": "平安银行北京分行顺义东兴路分行" },
                                        { "id": "555 - 222 - 222", "name": "平安银行北京分行顺义下关路分行" },
                                        { "id": "555 - 222 - 333", "name": "平安银行北京分行顺义滨河南路分行" }
                                    ]
                                },
                                { "id": "555 - 333", "name": "平安银行北京分行顺义五里仓分行" },
                                { "id": "555 - 444", "name": "平安银行北京分行顺义西环路分行" }
                            ]
                        },
                        { "id": "666", "name": "平安银行北京分行长安街分行" },
                        { "id": "101010", "name": "平安银行北京分行西直门分行" },
                        { "id": "111111", "name": "平安银行北京分行东直门分行" },
                        { "id": "121212", "name": "平安银行北京分行崇文门分行" },
                        { "id": "131313", "name": "平安银行北京分行鼓楼分行" },
                        { "id": "141414", "name": "平安银行北京分行左安门分行",
                            "items": 
                            [
                                { "id": "141414 - 111", "name": "平安银行北京分行左安门方庄分行" },
                                { "id": "141414 - 222", "name": "平安银行北京分行左安门芳星园分行" }
                            ]                     
                        }
                    ]
        }
    </script>
    
    <!-- GetCompanyWorkload -->
    <script type="text/javascript">
        //机构工作量
        function GetCompanyWorkload() {
            var chartGroupData = getData(chartGroupData);

            $.jqplot('StatisticsChartBlock', [chartGroupData.Datas], 
            {
                legend: { show: true, location: 'ne', xoffset: 55 },
                title: '机构业务量统计',
                seriesDefaults: 
                {
                    renderer: $.jqplot.BarRenderer,
                    rendererOptions: { barPadding: 8, barMargin: 20 }
                },
                series: 
                [
                    { label: 'Profits' },
                    { label: 'Expenses' },
                    { label: 'Sales' }
                ],
                axes: 
                {
                    xaxis: 
                    {
                        renderer: $.jqplot.CategoryAxisRenderer,
                        ticks: chartGroupData.Groups
                    },
                    yaxis: { min: 0 }
                }
            });

            function getData(chartGroupData) 
            {
                var chartGroup = new Array();
                var chartData = new Array();
                
                loadGroup(chartGroup, IHMSData.CompanyGroup.items);

                for (var i = 0; i < chartGroup.length; i++) {
                    var x = Math.floor(Math.random() * 1000);
                    chartData.push(x);
                }

                chartGroupData = { Groups: chartGroup, Datas: chartData };

                return chartGroupData;
            }

            //机构树的读取函数(递归)
            function loadGroup(chartGroup, array) {
                for (var i = 0; i < array.length; i++) {
                    chartGroup.push(array[i].name);
                    if (!jQuery.isEmptyObject(array[i].items)) {
                        if (array[i].items.length > 0) {
                            loadGroup(chartGroup, array[i].items);
                        }
                    };
                };
            }//loadGroup

        }
    </script>


    <!------------------------------------>
    <!--   一些公用的组件 UICommon      -->
    <!------------------------------------>

    <script type="text/javascript">
        var UICommon = {
            version: '2010.6.0',
            email: 'lukan.pan@gmail.com'
        }
    </script>
    
    <!--机构树面板: BuildCompanyGroupTreePanel-->
    <script type="text/javascript">

        //创建机构树面板
        function BuildCompanyGroupTreePanel()
        {

            //机构树的根节点
            var rootNode = new Ext.tree.TreeNode
            ({
                id: IHMSData.CompanyGroup.id,
                text: IHMSData.CompanyGroup.name
            });

            //递归读取机构树
            loadGroup(rootNode, IHMSData.CompanyGroup.items);

            var node;
            //机构树的读取函数(递归)
            function loadGroup(treenode, array) 
            {
                for (var i = 0; i < array.length; i++) 
                {
                    node = new Ext.tree.TreeNode
                    ({
                        id: array[i].id,
                        text: array[i].name
                    });
                    treenode.appendChild(node);
                    if (!jQuery.isEmptyObject(array[i].items)) 
                    {
                        if (array[i].items.length > 0) 
                        {
                            loadGroup(node, array[i].items);
                        }
                    };
                };
            }

            //机构树面板
            var panel = new Ext.tree.TreePanel
            ({
                title: IHMSData.UITxt.companyGroupTreeRoot,
                region: 'west',
                width: 260,
                margins: '3 0 3 3',
                cmargins: '3 3 3 3',

                collapsible: true,
                useArrows: true,
                autoScroll: true,
                animate: true,
                enableDD: true,
                containerScroll: true,
                split: true,
                //TODO: auto create by TreeLoader
                //dataUrl: Java Action,
                root: rootNode
            });

            //定义机构树面板节点的点击事件
            panel.on("click", function(node) 
            {
                Ext.Msg.show
                ({
                    title: ' 提示',
                    msg: "你单击了:<br />" + node.id + "<br />" + node.text,
                    animEl: node.ui.textNode
                });
            });
            return panel;
        }
    </script>
    
    <!--图表面板: BuildStatisticsManagementChartPanel-->
    <script type="text/javascript">
        function BuildStatisticsManagementChartPanel() 
        {
            var panel = new Ext.Panel
            ({
                id: 'StatisticsChart',
                region: 'center',
                margins: '3 0 3 3',
                cmargins: '3 3 3 3',
                tbar: [
                {
                    text: '统计数据',
                    iconCls: 'icon-StatisticsDataButton'
                }, '-', { 
                    xtype: 'splitbutton',
                    text: '数据统计图示',
                    iconCls: 'icon-StatisticsManagementPanel',
                    menu:
                    [
                        getStatisticsChartMenuItem("机构业务量统计"),
                        getStatisticsChartMenuItem("时段业务量统计"),
                        '-',
                        getStatisticsChartMenuItem("办理人数统计"),
                        getStatisticsChartMenuItem("等候时长统计"),
                        getStatisticsChartMenuItem("办理时长统计"),
                        '-',
                        getStatisticsChartMenuItem("柜员考勤统计"),
                        '-',
                        getStatisticsChartMenuItem("取号机取号量"),
                        getStatisticsChartMenuItem("取号类别统计")
                    ]
                },'-',{
                    xtype:'splitbutton',
                    text: 'Cut',
                    iconCls: 'add16',
                    menu: [{text: 'Cut Menu Item'}]
                },{
                    text: 'Copy',
                    iconCls: 'add16'
                },{
                    text: 'Paste',
                    iconCls: 'add16',
                    menu: [{text: 'Paste Menu Item'}]
                },'-',{
                    text: 'Format',
                    iconCls: 'add16'
                }],
                html: '<div id="StatisticsChartBlock" style="text-align:center;height:450px;width:650px; "></div>'
            });
            return panel;
        }

        function getStatisticsChartMenuItem(menuStr) {
            var menuitem = new Ext.menu.Item({
                text: menuStr,
                iconCls: 'icon-StatisticsManagementPanel'//menuStr + "-icon"
            })
            return menuitem;
        }
        
    </script>

    <!------------------------------------>
    <!--       模块：IHMSModule         -->
    <!------------------------------------>
    
    <!--载入相应的模块及开始菜单-->
    <script type="text/javascript">
        IHMSModule = new Ext.app.App({
            init: function() {
                Ext.QuickTips.init(); //把 ext:qtip 的值用于显示提示
            },
            getModules: function() {
                return [
                    // 以下是模块的载入，在我们的权限中，模块即为资源
                    // 所以以下模块的实例需用Jsp根据当前用户的权限来载入相应的实例
                    new IHMSModule.CustomManagementPanel(),
                    new IHMSModule.OperationManagementPanel(),
                    new IHMSModule.DeviceManagementPanel(),
                    new IHMSModule.StatisticsManagementPanel(),
                    new IHMSModule.BookingManagementPanel(),
                    new IHMSModule.SystemManagementPanel()
					];
            },

            // 组装开始菜单
            getStartConfig: function() {
                return {
                    title: IHMSData.UITxt.StartMenuWorkerTxt.concat(' : ').concat(IHMSData.ConfigJson.WorkerName),
                    iconCls: 'user',
                    toolItems: [{
                        text: IHMSData.UITxt.StartMenuSettingTxt,
                        iconCls: 'settings',
                        scope: this
                    }, '-', {
                        text: IHMSData.UITxt.StartMenuLogoutTxt,
                        iconCls: 'logout',
                        scope: this
                        }]
                    };
                }
            });
    </script>
    
    <!--模块：CustomManagementPanel(客户管理)-->
    <script type="text/javascript">
        IHMSModule.CustomManagementPanel = Ext.extend(Ext.app.Module, 
        {
            id: "CustomManagementPanel",
            init: function() 
            {
                this.launcher = 
                {
                    text: '客户管理',
                    iconCls: 'icon-CustomManagementPanel',
                    handler: this.createWindow,
                    scope: this
                }
            },

            createWindow: function() 
            {
                var desktop = this.app.getDesktop();
                var win = desktop.getWindow('CustomManagementPanel');
                if (!win) {
                    win = desktop.createWindow({
                        id: 'CustomManagementPanel',
                        title: "客户管理",
                        width: 640,
                        height: 480,
                        html: '<p>客户管理...</p>',
                        iconCls: 'icon-CustomManagementPanel',
                        shim: false,
                        animCollapse: false,
                        constrainHeader: true
                    });
                }
                win.show();
            }
        });    </script>

    <!--模块：OperationManagementPanel(业务管理)-->
    <script type="text/javascript">
        IHMSModule.OperationManagementPanel = Ext.extend(Ext.app.Module, 
        {
            id: "OperationManagementPanel",
            init: function() 
            {
                this.launcher = 
                {
                    text: '业务管理',
                    iconCls: 'icon-OperationManagementPanel',
                    handler: this.createWindow,
                    scope: this
                }
            },

            createWindow: function() 
            {
                var desktop = this.app.getDesktop();
                var win = desktop.getWindow('OperationManagementPanel');
                if (!win) {
                    win = desktop.createWindow({
                        id: 'OperationManagementPanel',
                        title: "业务管理",
                        width: 640,
                        height: 480,
                        html: '<p>业务管理...</p>',
                        iconCls: 'icon-OperationManagementPanel',
                        shim: false,
                        animCollapse: false,
                        constrainHeader: true
                    });
                }
                win.show();
            }
        });
    </script>

    <!--模块：DeviceManagementPanel(设备管理)-->
    <script type="text/javascript">
        IHMSModule.DeviceManagementPanel = Ext.extend(Ext.app.Module,
        {
            id: "DeviceManagementPanel",
            init: function() 
            {
                this.launcher = 
                {
                    text: '设备管理',
                    iconCls: 'icon-DeviceManagementPanel',
                    handler: this.createWindow,
                    scope: this
                }
            },

            createWindow: function() 
            {
                var desktop = this.app.getDesktop();
                var win = desktop.getWindow('DeviceManagementPanel');
                if (!win) {
                    win = desktop.createWindow({
                        id: 'DeviceManagementPanel',
                        title: "设备管理",
                        width: 640,
                        height: 480,
                        html: '<p>设备管理...</p>',
                        iconCls: 'icon-DeviceManagementPanel',
                        shim: false,
                        animCollapse: false,
                        constrainHeader: true
                    });
                }
                win.show();
            }
        });
    </script>

    <!--模块：StatisticsManagementPanel(统计管理)-->
    <script type="text/javascript">
        IHMSModule.StatisticsManagementPanel = Ext.extend(Ext.app.Module, {
            id: 'StatisticsManagementPanel',
            init: function() {
                this.launcher = {
                    text: IHMSData.UITxt.Modules.StatisticsManagementPanel.Text,
                    iconCls: 'icon-StatisticsManagementPanel',
                    handler: this.createWindow,
                    scope: this
                }
            },
            createWindow: function() {
                var desktop = this.app.getDesktop();
                var win = desktop.getWindow('StatisticsManagementPanel');
                if (!win) {
                    win = desktop.createWindow({
                        id: 'StatisticsManagementPanel',
                        title: IHMSData.UITxt.Modules.StatisticsManagementPanel.Text,
                        width: GeanJs.GetBrowserWidth() * 0.8,
                        height: GeanJs.GetBrowserHeight() * 0.85,
                        iconCls: 'icon-StatisticsManagementPanel',
                        shim: false,
                        animCollapse: false,
                        border: false,
                        constrainHeader: true,
                        plain: true,
                        layout: 'border', //将容器分为五个区域:east,south,west,north,center

                        items:
                        [
                            BuildCompanyGroupTreePanel(), BuildStatisticsManagementChartPanel()
                        ]
                    });
                    // 载入机构工作量
                    GetCompanyWorkload();
                }
                win.show();
            }
        });
    </script>

    <!--模块：BookingManagementPanel(预约管理)-->
    <script type="text/javascript">
        IHMSModule.BookingManagementPanel = Ext.extend(Ext.app.Module, 
        {
            id: "BookingManagementPanel",
            init: function() {
                this.launcher = {
                    text: '预约管理',
                    iconCls: 'icon-BookingManagementPanel',
                    handler: this.createWindow,
                    scope: this
                }
            },

            createWindow: function(src) {
                var desktop = this.app.getDesktop();
                var win = desktop.getWindow('BookingManagementPanel');
                if (!win) {
                    win = desktop.createWindow({
                        id: 'BookingManagementPanel',
                        title: "预约管理",
                        width: 640,
                        height: 480,
                        html: '<p>预约管理...</p>',
                        iconCls: 'icon-BookingManagementPanel',
                        shim: false,
                        animCollapse: false,
                        constrainHeader: true
                    });
                }
                win.show();
            }
        });
    </script>

    <!--模块：SystemManagementPanel(系统管理)-->
    <script type="text/javascript">
        IHMSModule.SystemManagementPanel = Ext.extend(Ext.app.Module,
        {
            id: "SystemManagementPanel",
            init: function() 
            {
                this.launcher = 
                {
                    text: '系统管理',
                    iconCls: 'icon-SystemManagementPanel',
                    handler: this.createWindow,
                    scope: this
                }
            },

            createWindow: function() 
            {
                var desktop = this.app.getDesktop();
                var win = desktop.getWindow('SystemManagementPanel');
                if (!win) {
                    win = desktop.createWindow({
                        id: 'SystemManagementPanel',
                        title: "系统管理",
                        width: 640,
                        height: 480,
                        html: '<p>系统管理...</p>',
                        iconCls: 'icon-SystemManagementPanel',
                        shim: false,
                        animCollapse: false,
                        constrainHeader: true
                    });
                }
                win.show();
            }
        });
    </script>


    <!--桌面部份-->
    <div id="x-desktop">
        <dl id="x-shortcuts">
            <!-- 快捷方式的id按被调用的窗体 + ‘-shortcut’ 组成 -->
            <dt id="CustomManagementPanel-shortcut"><a href="#">
                <img src="lib/extjs/pan/images/s.gif" alt="CustomManagement" /><br />
                <span id="CustomManagementPanel-txt"></span>
            </a></dt>
            <dt id="OperationManagementPanel-shortcut"><a href="#">
                <img src="lib/extjs/pan/images/s.gif" alt="OperationManagementPanel" /><br />
                <span id="OperationManagementPanel-txt"></span>
            </a></dt>
            <dt id="DeviceManagementPanel-shortcut"><a href="#">
                <img src="lib/extjs/pan/images/s.gif" alt="DeviceManagementPanel" /><br />
                <span id="DeviceManagementPanel-txt"></span>
            </a></dt>
            <dt id="StatisticsManagementPanel-shortcut"><a href="#">
                <img src="lib/extjs/pan/images/s.gif" alt="StatisticsManagementPanel" /><br />
                <span id="StatisticsManagementPanel-txt"></span>
            </a></dt>
            <dt id="BookingManagementPanel-shortcut"><a href="#">
                <img src="lib/extjs/pan/images/s.gif" alt="BookingManagementPanel" /><br />
                <span id="BookingManagementPanel-txt"></span>
            </a></dt>
            <dt id="SystemManagementPanel-shortcut"><a href="#">
                <img src="lib/extjs/pan/images/s.gif" alt="SystemManagementPanel" /><br />
                <span id="SystemManagementPanel-txt"></span>
            </a></dt>
            <!-- shortcut end -->
        </dl>
    </div>
    <!--开始按钮 任务栏-->
    <div id="ux-taskbar">
        <div id="ux-taskbar-start">
        </div>
        <div id="ux-taskbuttons-panel">
        </div>
        <div class="x-clear">
        </div>
    </div>
    
    
    <!--页面载入后的一些操作-->
    <script type="text/javascript">
        $("title").empty();
        //对TITLE节点进行操作，打印用户单位名称及软件与软件版本号
        $("title").append(
            IHMSData.CompanyGroup.name.concat(" - ").
            concat(IHMSData.ConfigJson.SoftwareName).
            concat(" ").
            concat(IHMSData.ConfigJson.SoftwareVersion));
        $("#CustomManagementPanel-txt").append(IHMSData.UITxt.Modules.CustomManagementPanel.Text);
        $("#OperationManagementPanel-txt").append(IHMSData.UITxt.Modules.OperationManagementPanel.Text);
        $("#DeviceManagementPanel-txt").append(IHMSData.UITxt.Modules.DeviceManagementPanel.Text);
        $("#StatisticsManagementPanel-txt").append(IHMSData.UITxt.Modules.StatisticsManagementPanel.Text);
        $("#BookingManagementPanel-txt").append(IHMSData.UITxt.Modules.BookingManagementPanel.Text);
        $("#SystemManagementPanel-txt").append(IHMSData.UITxt.Modules.SystemManagementPanel.Text);
    </script>

</body>

</html>
